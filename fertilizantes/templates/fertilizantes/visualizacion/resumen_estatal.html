{% extends "fertilizantes/base.html" %}
{% load static %}

{% block title %}Resumen Estatal{% endblock %}

{% block extra_css %}
<style>
  /* Encabezados de Colores Institucionales */
  .bg-abasto { background-color: #004634 !important; color: white; }
  .bg-entregado { background-color: #146B4D !important; color: white; }
  .bg-dh { background-color: #6A1B3F !important; color: white; }
  .bg-superficie { background-color: #A1760E !important; color: white; }

  /* Colores de Barras */
  .progress-bar.abasto { background-color: #004634; }
  .progress-bar.entregado { background-color: #146B4D; }
  .progress-bar.dh { background-color: #6A1B3F; }
  .progress-bar.superficie { background-color: #A1760E; }

  /* Ajustes finos de tabla */
  #tabla_estados th, #tabla_estados td {
    font-size: 0.7rem;
    vertical-align: middle;
    white-space: nowrap;
  }
  .progress {
    background-color: #e9ecef;
    border-radius: 4px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
    position: relative;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4 mb-5">
  
  <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold" style="color: #264e46;">
          <i class="bi bi-table me-2"></i>Resumen Estatal
      </h3>
      <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">
          <i class="bi bi-printer"></i> Imprimir
      </button>
  </div>

  <div class="card shadow-sm border-0 mb-4 bg-light">
    <div class="card-body p-3">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted">Unidad Operativa</label>
              <input class="form-control border-0 shadow-sm" list="coord" id="filtro_unidad" placeholder="Buscar...">
              <datalist id="coord"></datalist>
            </div>
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted">Estado</label>
              <input class="form-control border-0 shadow-sm" list="estados" id="filtro_estado" placeholder="Buscar...">
              <datalist id="estados"></datalist>
            </div>
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted">Tipo de Meta</label>
              <select class="form-select border-0 shadow-sm" id="filtro_tipo_meta">
                <option value="operativa" selected>Metas operativas</option>
                <option value="oficial">Metas oficiales</option>
              </select>
            </div>
            <div class="col-md-3 text-end">
                <small class="text-muted fst-italic">Actualización automática al filtrar.</small>
            </div>
        </div>
    </div>
  </div>

  <div class="card shadow-sm border-0">
      <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 700px; overflow-y: auto;">
            <table class="table table-bordered table-hover text-center mb-0" id="tabla_estados">
              <thead class="sticky-top" style="z-index: 10;">
                <tr>
                  <th rowspan="2" class="align-middle bg-secondary text-white">Estado</th>
                  <th colspan="4" class="bg-abasto">Abasto (t)</th>
                  <th colspan="4" class="bg-entregado">Entregado (t)</th>
                  <th colspan="4" class="bg-dh">Beneficiarios</th>
                  <th colspan="4" class="bg-superficie">Superficie (ha)</th>
                </tr>
                <tr class="small bg-light text-dark">
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="17" class="py-5 text-muted">
                    <div class="spinner-border spinner-border-sm text-secondary me-2"></div> Cargando datos...
                </td></tr>
              </tbody>
            </table>
          </div>
      </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/chart.umd.min.js' %}"></script>
<script src="{% static 'js/dashboards.js' %}"></script>
{% endblock %}