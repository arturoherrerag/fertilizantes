{% extends "fertilizantes/base.html" %}
{% load static %}

{% block title %}Resumen Estatal{% endblock %}

{% block extra_css %}
<style>
  /* --- ESTILO COMPACTO TIPO REPORTE --- */
  
  /* Contenedor principal */
  .container-fluid {
    max-width: 100%;
    padding: 0 15px;
  }

  /* Tabla */
  #tabla_estados {
    font-size: 0.75rem; /* Letra pequeña y nítida */
    border-collapse: collapse;
    width: 100%;
    background-color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  #tabla_estados th, #tabla_estados td {
    padding: 3px 5px; /* Padding mínimo para compactar */
    vertical-align: middle;
    border: 1px solid #d1d1d1;
    line-height: 1.2;
  }

  /* --- ENCABEZADOS --- */
  #tabla_estados thead tr:first-child th {
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.3);
    font-size: 0.7rem;
    letter-spacing: 0.5px;
  }

  /* Sub-encabezados (Meta, Avance...) */
  #tabla_estados thead tr:last-child th {
    background-color: #f2f2f2;
    color: #333;
    font-weight: 700;
    font-size: 0.65rem;
    text-align: center;
  }

  /* Columna Estado Fija */
  .col-estado {
    font-weight: 700;
    text-align: left;
    background-color: #6c757d; /* Gris oscuro como tu referencia */
    color: #fff;
    width: 140px; /* Ancho fijo */
    white-space: nowrap;
  }

  /* --- COLORES INSTITUCIONALES (Definición Global) --- */
  .pf-bg-abasto { background-color: #004634 !important; color: white; }
  .pf-bg-entregado { background-color: #146B4D !important; color: white; }
  .pf-bg-dh { background-color: #6A1B3F !important; color: white; }
  .pf-bg-superficie { background-color: #A1760E !important; color: white; }

  /* --- BARRAS DE PROGRESO --- */
  .td-porcentaje {
    width: 55px; /* Ancho fijo para la columna de % */
    padding: 1px !important;
    text-align: center;
  }

  .pf-progress-container {
    background-color: #e0e0e0;
    height: 14px; /* Barra delgada */
    width: 100%;
    border-radius: 2px;
    position: relative;
    overflow: hidden;
  }

  .pf-progress-bar {
    height: 100%;
    display: block;
    /* El color de fondo se asigna vía clase o inline style en JS */
  }

  /* Texto del porcentaje */
  .pf-progress-text {
    position: absolute;
    width: 100%;
    top: 0;
    left: 0;
    line-height: 14px;
    text-align: center;
    font-size: 0.6rem;
    font-weight: 700;
    color: #fff;
    text-shadow: 0 0 2px #000; /* Sombra negra para leer sobre cualquier color */
    z-index: 5;
  }

  /* Alineación de números */
  .text-numero {
    text-align: right;
    font-variant-numeric: tabular-nums; /* Alinea los números verticalmente */
  }
  
  /* Fila de Totales */
  .row-total td {
    background-color: #343a40;
    color: white;
    font-weight: bold;
    border-top: 2px solid #000;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-3 mb-5 year-{{ anio_actual }}">
  
  <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="fw-bold" style="color: #264e46;">
          <i class="bi bi-table me-2"></i>Resumen Estatal
      </h4>
      <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">
          <i class="bi bi-printer"></i> Imprimir
      </button>
  </div>

  <!-- Filtros Compactos -->
  <div class="card shadow-sm border-0 mb-3 bg-light">
    <div class="card-body p-2">
        <div class="row g-2 align-items-end">
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted mb-0">Unidad Operativa</label>
              <input class="form-control form-control-sm border-0 shadow-sm" list="coord" id="filtro_unidad" placeholder="Todas">
              <datalist id="coord"></datalist>
            </div>
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted mb-0">Estado</label>
              <input class="form-control form-control-sm border-0 shadow-sm" list="estados" id="filtro_estado" placeholder="Todos">
              <datalist id="estados"></datalist>
            </div>
            <div class="col-md-3">
              <label class="form-label small fw-bold text-muted mb-0">Tipo de Meta</label>
              <select class="form-select form-select-sm border-0 shadow-sm" id="filtro_tipo_meta">
                <option value="operativa" selected>Metas operativas</option>
                <option value="oficial">Metas oficiales</option>
              </select>
            </div>
            <div class="col-md-3 text-end">
                <small class="text-muted fst-italic" style="font-size: 0.7rem;">Actualización automática.</small>
            </div>
        </div>
    </div>
  </div>

  <div class="card shadow-sm border-0">
      <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-bordered mb-0" id="tabla_estados">
              <thead>
                <tr>
                  <!-- CORRECCIÓN: Usamos las clases pf-bg-* aquí -->
                  <th rowspan="2" class="align-middle" style="background-color: #6c757d;">ESTADO</th>
                  <th colspan="4" class="pf-bg-abasto">ABASTO (t)</th>
                  <th colspan="4" class="pf-bg-entregado">ENTREGADO (t)</th>
                  <th colspan="4" class="pf-bg-dh">BENEFICIARIOS</th>
                  <th colspan="4" class="pf-bg-superficie">SUPERFICIE (ha)</th>
                </tr>
                <tr>
                  <!-- Sub-encabezados -->
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                  <th>Meta</th><th>Avance</th><th>Pend.</th><th>%</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="17" class="text-center py-4 text-muted">
                    <div class="spinner-border spinner-border-sm text-secondary me-2"></div> Cargando datos...
                </td></tr>
              </tbody>
            </table>
          </div>
      </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/chart.umd.min.js' %}"></script>
<script src="{% static 'js/dashboards.js' %}?v={% now 'U' %}"></script> <!-- Cache busting -->
{% endblock %}